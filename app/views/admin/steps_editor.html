<!--

This comment is needed in order to push the following strings on transifex

<span data-translate>Delete</span>

-->

<br />
<div data-ng-controller="AdminStepAddCtrl">
  <h4><span data-translate>Add new step</span></h4>
  <div data-ng-form="" name="newStep">
    <div class="row">
      <div class="col-md-12">
        <div class="form-group">
          <label data-translate>Label</label>
          <input class="form-control" data-ng-model="new_step_label" type="text" required>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <div class="form-group">
          <button class="pull-left btn btn-success" data-ng-disabled="newStep.$invalid" data-ng-click="add_step()">
            <i class="glyphicon glyphicon-ok"></i>
            <span data-translate>Add</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<br /><br />
<div data-ng-if="context.steps.length">
  <h4><span data-translate>Configured steps:</span></h4>
  <div class="row">
    <div ui-sortable="sortableOptions" data-ng-model="context.steps">
      <div data-ng-repeat="step in context.steps">
        <div 
             class="stepBox"
             data-ng-class="{'col-md-6': !editing, 'col-md-12': editing}"
             data-ng-init="editing=false"
             data-ng-controller="AdminStepEditorCtrl">
          <div class="card step">
            <div class="stepEditorHeader handle">
              <div class="stepIndex">{{$index}}</div>
              <h2>{{step.label}}</h2>
            </div>
            <div data-ng-form="" name="editStep" class="stepEditorBody" data-ng-show="editing">
              <hr>
              <div class="row">
                <div class="form-group col-md-6">
                  <label data-translate>Label</label>
                  <input class="form-control" data-ng-model="step.label" type="text">
                </div>
                <div class="form-group col-md-6">
                  <label data-translate>Hint</label>
                  <input class="form-control" data-ng-model="step.hint" type="text">
                </div>
              </div>
              <div class="row">
                <div class="form-group col-md-6">
                  <label data-translate>Description</label>
                  <div>
                    <textarea class="form-control" data-ng-model="step.description">{{step.description}}</textarea>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6" data-ng-include="'views/admin/add_fields.html'"></div>
                <div class="col-md-6" data-ng-include="'views/admin/add_fields_template.html'"></div>
              </div>
              <div class="form-group" data-ng-if="step.children.length">
                <label data-translate>Configured fields:</label>
                  <div data-ng-model="step.children"
                       class="configuredFields"
                       data-ui-on-drop="onDrop($data, $event, step)">
                    <div data-ng-repeat="field_key in step.children">
                      <div data-ng-include="'views/admin/edit_field.html'"></div>
                    </div>
                  </div>
              </div>
            </div>
            <hr>
            <div class="stepActions">
              <button class="btn btn-default actionButton"
                      data-ng-show="!editing"
                      data-ng-click="editing=!editing">Edit</button>
              <button class="btn btn-success actionButton"
                      data-ng-show="editing"
                      data-ng-click="save_context(context);editing=!editing"
                      type="submit">Save</button>
              <button 
                class="btn btn-default actionButton"
                data-ng-show="editing"
                data-ng-click="editing=!editing">Cancel
              </button>
              <button class="btn btn-danger actionButton"
                      data-ng-click="deleteStep(step)"
                      popover="{{ Delete | translate }}"
                      popover-placement="right"
                      popover-trigger="mouseenter">Delete</button>
            </div>
          </div>
        <!-- Step end -->
        </div>
      <div class="clearfix" ng-if="$last"></div>
      <!-- Repeat end -->
      </div>
    </div>
  </div>
</div>
